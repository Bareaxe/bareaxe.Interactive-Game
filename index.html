<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Quiz Platformer</title>

<style>
body {
  margin: 0;
  background: #111;
  overflow: hidden;
  font-family: monospace;
}

canvas {
  display: block;
  margin: auto;
  background: linear-gradient(#6bd6ff, #dff6ff);
}
</style>
</head>

<body>
<canvas id="game" width="900" height="450"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const gravity = 0.6;
let gameState = "play";

const keys = {};
window.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
window.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

/* ---------------- QUESTION BANK ---------------- */

const questionBank = [
  {
    question: "What is 5 + 7?",
    answers: ["10","11","12","13"],
    correct: 2
  },
  {
    question: "Which planet is known as the Red Planet?",
    answers: ["Earth","Mars","Jupiter","Venus"],
    correct: 1
  },
  {
    question: "Water freezes at what Â°C?",
    answers: ["0","32","-10","100"],
    correct: 0
  },
  {
    question: "Which gas do plants need?",
    answers: ["Oxygen","Nitrogen","Carbon Dioxide","Hydrogen"],
    correct: 2
  }
];

// Pick random question
const currentQuestion = questionBank[
  Math.floor(Math.random()*questionBank.length)
];

/* ---------------- PLAYER ---------------- */

const player = {
  x: 100,
  y: 300,
  w: 40,
  h: 50,
  vx: 0,
  vy: 0,
  onGround: false,
  frame: 0,
  animTimer: 0
};

/* ---------------- WORLD ---------------- */

const groundY = 380;

const platforms = [
  {x: 500, y: 300, w: 140, h: 20},
  {x: 750, y: 240, w: 140, h: 20},
  {x: 1000, y: 180, w: 140, h: 20},
  {x: 1250, y: 120, w: 140, h: 20}
];

// Doors built from question
const doors = [
  {x: 520, y: 240, answer: currentQuestion.answers[0], good: false},
  {x: 770, y: 180, answer: currentQuestion.answers[1], good: false},
  {x: 1020, y: 120, answer: currentQuestion.answers[2], good: false},
  {x: 1270, y: 60, answer: currentQuestion.answers[3], good: false}
];

// Mark correct door
doors[currentQuestion.correct].good = true;

let cameraX = 0;

/* ---------------- UPDATE ---------------- */

function update(){
  if(gameState !== "play") return;

  if(keys["a"]) player.vx = -4;
  else if(keys["d"]) player.vx = 4;
  else player.vx *= 0.8;

  if((keys["w"] || keys[" "]) && player.onGround){
    player.vy = -16;
    player.onGround = false;
  }

  player.vy += gravity;
  player.x += player.vx;
  player.y += player.vy;

  player.onGround = false;

  if(player.y + player.h >= groundY){
    player.y = groundY - player.h;
    player.vy = 0;
    player.onGround = true;
  }

  platforms.forEach(p=>{
    if(
      player.x < p.x+p.w &&
      player.x+player.w > p.x &&
      player.y+player.h > p.y &&
      player.y+player.h < p.y+p.h+10 &&
      player.vy >= 0
    ){
      player.y = p.y - player.h;
      player.vy = 0;
      player.onGround = true;
    }
  });

  cameraX = player.x - 200;

  player.animTimer++;
  if(player.animTimer>8){
    player.frame=(player.frame+1)%4;
    player.animTimer=0;
  }

  // Door collision
  doors.forEach(d=>{
    if(
      player.x < d.x+50 &&
      player.x+player.w > d.x &&
      player.y < d.y+60 &&
      player.y+player.h > d.y
    ){
      gameState = d.good ? "win" : "lose";
    }
  });
}

/* ---------------- DRAW ---------------- */

function drawPlayer(){
  const colors=["#ff4444","#ff7777","#ffaaaa","#ff7777"];
  ctx.fillStyle=colors[player.frame];
  ctx.fillRect(player.x-cameraX,player.y,player.w,player.h);

  ctx.fillStyle="#000";
  ctx.fillRect(player.x-cameraX+10,player.y+15,5,5);
  ctx.fillRect(player.x-cameraX+25,player.y+15,5,5);
}

function drawWorld(){
  ctx.fillStyle="#4caf50";
  ctx.fillRect(0,groundY,canvas.width,canvas.height-groundY);

  ctx.fillStyle="#8d6e63";
  platforms.forEach(p=>{
    ctx.fillRect(p.x-cameraX,p.y,p.w,p.h);
  });

  doors.forEach(d=>{
    ctx.fillStyle="#5d4037";
    ctx.fillRect(d.x-cameraX,d.y,50,60);

    ctx.fillStyle="#ffd700";
    ctx.fillRect(d.x-cameraX+35,d.y+30,8,8);

    // Answer text
    ctx.fillStyle="#000";
    ctx.font="14px monospace";
    ctx.fillText(d.answer, d.x-cameraX-10, d.y-10);
  });
}

function drawQuestion(){
  ctx.fillStyle="#000";
  ctx.font="20px monospace";
  ctx.textAlign="center";
  ctx.fillText(
    currentQuestion.question,
    canvas.width/2,
    40
  );
  ctx.textAlign="left";
}

function drawOverlay(text){
  ctx.fillStyle="rgba(0,0,0,0.7)";
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="#fff";
  ctx.font="36px monospace";
  ctx.textAlign="center";
  ctx.fillText(text,canvas.width/2,canvas.height/2);
}

function drawUI(){
  drawQuestion();

  if(gameState==="win"){
    drawOverlay("CORRECT! YOU WIN!");
  }
  if(gameState==="lose"){
    drawOverlay("WRONG ANSWER!");
  }
}

/* ---------------- LOOP ---------------- */

function loop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  update();
  drawWorld();
  drawPlayer();
  drawUI();
  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
