<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Side Scroller Platformer</title>

<style>
body {
  margin: 0;
  overflow: hidden;
  background: #111;
}
canvas {
  display: block;
  background: linear-gradient(#5fc3ff, #cceeff);
}
</style>
</head>

<body>

<canvas id="game"></canvas>

<script>
/* =====================
   CANVAS SETUP
===================== */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

canvas.width = 900;
canvas.height = 500;

/* =====================
   CONSTANTS
===================== */
const GRAVITY = 0.6;
const FRICTION = 0.8;

/* =====================
   INPUT
===================== */
const keys = {};

window.addEventListener("keydown", e => keys[e.key] = true);
window.addEventListener("keyup", e => keys[e.key] = false);

/* =====================
   PLAYER
===================== */
const player = {
  x: 100,
  y: 0,
  width: 40,
  height: 50,
  dx: 0,
  dy: 0,
  speed: 5,
  jumpPower: 14,
  grounded: false
};

/* =====================
   CAMERA
===================== */
const camera = {
  x: 0
};

/* =====================
   PLATFORMS
===================== */
const platforms = [
  {x:0, y:450, w:2000, h:50},   // ground
  {x:300, y:350, w:200, h:20},
  {x:650, y:300, w:200, h:20},
  {x:1000, y:250, w:200, h:20},
  {x:1400, y:200, w:200, h:20}
];

/* =====================
   GOAL
===================== */
const goal = {
  x: 1800,
  y: 150,
  w: 40,
  h: 60
};

/* =====================
   UPDATE
===================== */
function update() {

  // Horizontal movement
  if(keys["a"]) player.dx = -player.speed;
  if(keys["d"]) player.dx = player.speed;

  // Jump
  if((keys["w"] || keys[" "]) && player.grounded) {
    player.dy = -player.jumpPower;
    player.grounded = false;
  }

  // Gravity
  player.dy += GRAVITY;

  // Apply movement
  player.x += player.dx;
  player.y += player.dy;

  player.dx *= FRICTION;

  // Collisions
  player.grounded = false;

  platforms.forEach(p => {
    if(
      player.x < p.x + p.w &&
      player.x + player.width > p.x &&
      player.y < p.y + p.h &&
      player.y + player.height > p.y
    ){
      // Landing
      if(player.dy > 0){
        player.y = p.y - player.height;
        player.dy = 0;
        player.grounded = true;
      }
    }
  });

  // Camera follow
  camera.x = player.x - canvas.width/2;

  // Win
  if(
    player.x < goal.x + goal.w &&
    player.x + player.width > goal.x &&
    player.y < goal.y + goal.h &&
    player.y + player.height > goal.y
  ){
    alert("You Win!");
    location.reload();
  }
}

/* =====================
   DRAW
===================== */
function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  ctx.save();
  ctx.translate(-camera.x,0);

  // Platforms
  ctx.fillStyle = "#654321";
  platforms.forEach(p => {
    ctx.fillRect(p.x, p.y, p.w, p.h);
  });

  // Goal
  ctx.fillStyle = "gold";
  ctx.fillRect(goal.x, goal.y, goal.w, goal.h);

  // Player
  ctx.fillStyle = "red";
  ctx.fillRect(player.x, player.y, player.width, player.height);

  ctx.restore();
}

/* =====================
   LOOP
===================== */
function gameLoop(){
  update();
  draw();
  requestAnimationFrame(gameLoop);
}

gameLoop();
</script>

</body>
</html>
